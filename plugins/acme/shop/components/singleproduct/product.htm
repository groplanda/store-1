{% set index = 1 %}
<div class="breadcrumbs section">
  <div class="breadcrumbs__wrap wrap" itemscope itemtype="https://schema.org/BreadcrumbList">
    {% for breadcrumb in breadcrumbs %}
    {% if not loop.last %}
    <div class="breadcrumbs__item" itemscope itemtype="https://schema.org/BreadcrumbList">
      <a itemprop="item" class="breadcrumbs__link" href="{{ breadcrumb.category ? 'category'|page({slug: breadcrumb.url}) : breadcrumb.url|page }}">
        <span itemprop="name">{{ breadcrumb.title }}</span>
      </a>
      <div class="breadcrumbs__hidden" itemprop="url" href="{{ breadcrumb.category ? 'category'|page({slug: breadcrumb.url}) : breadcrumb.url|page }}"></div>
      <meta itemprop="position" content="{{ index }}" />
      <svg width="10" height="6" class="breadcrumbs__arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.94207 2.85L7.7199 0.824504C7.65816 0.774358 7.59066 0.764709 7.51735 0.79558C7.44412 0.82649 7.40735 0.882393 7.40735 0.96345V2.25976H0.185181C0.131143 2.25976 0.0867528 2.27709 0.0520719 2.31181C0.0174114 2.34651 0 2.3909 0 2.4449V3.55598C0 3.60996 0.0173303 3.65435 0.0520517 3.68901C0.0868136 3.72371 0.131203 3.74104 0.18516 3.74104H7.40739V5.03732C7.40739 5.11459 7.44422 5.17049 7.51741 5.20511C7.59079 5.2361 7.65828 5.22439 7.72002 5.17049L9.94219 3.12173C9.98076 3.08318 10 3.03696 10 2.9829C10 2.93288 9.98064 2.88857 9.94207 2.85Z" fill="black"/>
      </svg>
    </div>
    {% else %}
    <div class="breadcrumbs__item" itemscope itemtype="https://schema.org/BreadcrumbList" >
      <div itemprop="name" class="breadcrumbs__link">{{ breadcrumb.title }}</div>
      <div class="breadcrumbs__hidden" itemprop="item" itemprop="url" href="{{ 'product'|page({ id: breadcrumb.url }) }}"></div>
      <meta itemprop="position" content="{{ index }}" />
    </div>
    {% endif %}
    {% set index = loop.index + 1 %}
    {% endfor %}
  </div>
</div>
<section class="product product_page section" itemscope itemtype="https://schema.org/Product">
  <!-- meta start -->
  <meta itemprop="name" content="{{ product.meta_title ? product.meta_title : product.title }}" />
  <link itemprop="url" href="{{ this.page.url }}" />
  <link itemprop="image" href="{{ product.image|media }}" />
  {% if product.brand %}
  <meta itemprop="brand" content="{{ product.brand.title }}" />
  <meta itemprop="manufacturer" content="{{ product.brand.title }}" />
  {% endif %}
  <meta itemprop="model" content="{{ product.title }}" />
  <meta itemprop="gtin12" content="upc" />
  <meta itemprop="gtin8" content="ean" />
  <meta itemprop="productID" content="{{ product.code }}" />
  <meta itemprop="category" content="{{ product.categories[0].title }}" />
  <meta itemprop="description" content="{{ product.meta_description }}" />
  <!-- meta end -->
  <div class="wrap product__wrap">
    <div class="product__heading">
      <a href="{{ 'category' | page({ slug: product.categories[0].slug }) }}" class="product__heading-back">
        <svg class="product__heading-arrow" width="11" height="20" viewBox="0 0 11 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10.6195 0.990037C10.5034 0.873629 10.3655 0.781272 10.2136 0.718256C10.0617 0.65524 9.89893 0.622803 9.73451 0.622803C9.5701 0.622803 9.40729 0.65524 9.25543 0.718256C9.10357 0.781272 8.96563 0.873629 8.84951 0.990037L0.539515 9.30004C0.446811 9.39255 0.373263 9.50244 0.323082 9.62341C0.272901 9.74439 0.24707 9.87407 0.24707 10.005C0.24707 10.136 0.272901 10.2657 0.323082 10.3867C0.373263 10.5076 0.446811 10.6175 0.539515 10.71L8.84951 19.02C9.33951 19.51 10.1295 19.51 10.6195 19.02C11.1095 18.53 11.1095 17.74 10.6195 17.25L3.37951 10L10.6295 2.75004C11.1095 2.27004 11.1095 1.47004 10.6195 0.990037Z" fill="currentColor"/>
        </svg>
      </a>
      <div class="title product__title product__title_mobile">{{ product.title }}</div>
    </div>
    <div class="product__row">
      <div class="product__gallery">
        {% if product.image %}
        <div class="product__slider swiper" data-js-slider="product-view">
          <div class="swiper-wrapper">
            <div class="product__slider-item swiper-slide">
              <img src="{{ product.image|media|resize(600, 600, { mode: 'crop', quality: '90' }) }}" alt="{{ product.title }}" class="product__slider-img" />
            </div>
            {% for image in product.gallery %}
            <div class="product__slider-item swiper-slide">
              <img src="{{ image.path|resize(600, 600, { mode: 'crop', quality: '90' }) }}" alt="{{ image.title ? image.title : image.file_name }}" class="product__slider-img" />
            </div>
            {% endfor %}
          </div>
          {% if product.gallery|length > 0 %}
          <button class="product__slider-arrow product__slider-arrow_prev">
            <svg class="product__slider-arrow-ico" width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.125 1.75L1 6.875L6.125 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="product__slider-arrow product__slider-arrow_next">
            <svg class="product__slider-arrow-ico" width="8" height="13" viewBox="0 0 8 13" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1.875 11.25L7 6.125L1.875 0.999999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          {% endif %}
        </div>
        {% else %}
          <img src="{{ '/themes/store/assets/images/no-image.jpg'|resize(600, 600) }}" alt="{{ product.title }}" class="product__slider-img" />
        {% endif %}
      </div>
      <div class="product__content">
        <div class="product__content-info">
          <h1 class="title product__title product__title_desktop">{{ product.title }}</h1>
          <div class="product__price-wrap" itemprop="offers" itemscope itemtype="https://schema.org/Offer">

            <div class="product__price-group">
              <span data-js="price-current">
                {{ product.sale_price > 0 ? product.sale_price|number_format(0, '', ' ') : product.price|number_format(0, '', ' ') }}
              </span>
              <span data-js="price-old" class="product__price-old{{ product.sale_price == 0 ? ' product__price-old_hide' : '' }}">
                {{ product.price|number_format(0, '', ' ') }}
              </span>
              <span class="product__price-text">
                ₽ за 1шт
              </span>
            </div>

            <div class="qty qty_show qty_product" data-js-action="update-qty">
              <button type="button" class="qty__btn qty__btn_remove js-remove-cart">
                <svg class="qty__btn-ico" width="7" height="3" viewBox="0 0 7 3" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.205071 0.0799997H6.80507V2.576H0.205071V0.0799997Z" fill="currentColor"/>
                </svg>
              </button>
              <div class="qty__val" data-js-action="qty-val">1</div>
              <button type="button" class="qty__btn qty__btn_add js-add-cart">
                <svg class="qty__btn-ico" width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8.65941 5.6H5.47341V8.75H3.54741V5.6H0.361406V3.8H3.54741V0.649999H5.47341V3.8H8.65941V5.6Z" fill="currentColor"/>
                </svg>
              </button>
            </div>

            <meta itemprop="priceCurrency" content="RUB" />
            <meta itemprop="price" content="{{ product.sale_price ? product.sale_price : product.price }}" />
            <link itemprop="availability" href="https://schema.org/InStock" />
          </div>
          <div class="product__add-wrap">
            {% if product.price %}
            <button
              type="button"
              class="button button_primary product__add"
              data-product-id="{{ product.id }}"
              data-js-action="add-to-cart"
              data-product-amount="1"
              data-type="product-page"
            >
              Добавить в корзину
            </button>
            {% endif %}
            {% if user_id %}
            <button
              title="{{ is_wish ? 'убрать из избранного' : 'добавить в избранное' }}"
              type="button" class="button product__wish{{ is_wish ? ' product__wish_active' : '' }}"
              data-product-id="{{ product.id }}"
              data-user-id="{{ user_id }}"
              data-js-action="toggle-wish"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="product__wish-like" fill="currentColor" viewBox="0 0 16 16">
                <path d="M4 1c2.21 0 4 1.755 4 3.92C8 2.755 9.79 1 12 1s4 1.755 4 3.92c0 3.263-3.234 4.414-7.608 9.608a.513.513 0 0 1-.784 0C3.234 9.334 0 8.183 0 4.92 0 2.755 1.79 1 4 1z"/>
              </svg>
            </button>
            {% endif %}
          </div>
          <div class="product__description">
            {{ product.description|raw }}
          </div>
          <div class="product__prop">
            {% for prop in product.props %}
            <div class="product__prop-item">
              <div class="product__prop-thead">
                <div class="product__prop-label">{{ prop.props_option }}</div>
              </div>
              <div class="product__prop-val">{{ prop.props_value }}</div>
            </div>
            {% endfor %}
            {% if product.brand %}
            <div class="product__prop-item">
              <div class="product__prop-thead">
                <div class="product__prop-label">Бренд</div>
              </div>
              <div class="product__prop-val">{{ product.brand.title }}</div>
            </div>
            {% endif %}
          </div>
          {% if product.options|length > 0 %}
          <div class="product__options">
            <div class="product__options-title">Размеры: </div>
            <div class="product__options-row">
              {% for option in product.options %}
              <button
                type="button"
                class="product__options-item{{ loop.first ? ' product__options-item_active' : '' }}"
                data-price="{{ option.price }}"
                data-sale-price="{{ option.sale_price }}"
                data-type="{{ option.product_option.type }}"
                data-name="{{ option.product_option.name }}"
                data-option-id="{{ option.id }}"
                data-js-action="options"
              >
                {{ option.option_value.name }}
              </button>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="product__body">
      {% if product.featured|length > 0 %}
      <div class="product__featured">
        <div class="product__featured-title">Дополнительные цвета: </div>
        <div class="product__featured-row">
          {% for featured in product.featured %}
          <div class="product__featured-item">
            <img src="{{ featured.image|media|resize(false, 80, { mode: 'crop', quality: '80' }) }}" class="product__featured-img" alt="{{ featured.title }}" />
            <a href="#!" data-featured="{{ featured.id }}" title="{{ featured.title }}" class="product__featured-url"></a>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
      <div class="product__comment">
        <h3 class="title product__comment-title">Отзывы</h3>
        {% if product.comments|length > 0 %}
        <div class="product__comment-list">
          {% for comment in product.comments %}
          <div class="product__comment-item" itemscope itemtype="https://schema.org/Review">
            <div class="product__comment-heading">
              <div class="product__comment-name" itemprop="author">{{ comment.title }}</div>
              <div class="product__comment-date">{{ comment.created_at|date('d.m.Y - H:m') }}</div>
            </div>
            <meta itemprop="datePublished" content="{{ comment.created_at|date('Y-m-d') }}" />
            <div class="product__comment-stars" itemprop="reviewRating" itemscope itemtype="https://schema.org/Rating">
              <meta itemprop="worstRating" content = "1" />
              <meta itemprop="ratingValue" content="{{ comment.star }}" />
              <meta itemprop="bestRating" content="5" />
              {% for index in 1..5 %}
              <svg xmlns="http://www.w3.org/2000/svg" class="product__comment-star{{ index <= comment.star ? ' product__comment-star_active' : '' }}" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"></path>
              </svg>
              {% endfor %}
            </div>
            <p class="product__comment-decription">{{ comment.description }}</p>
          </div>
          {% endfor %}
        </div>
        {% else %}
          <p class="product__comment-empty">Отзывов пока нет...</p>
        {% endif %}
        <button type="button" class="button button_primary product__add" data-js-action="open-modal" data-type-modal="add-comment" data-product-id="{{ product.id }}">Оставить отзыв</button>
      </div>
    </div>
  </div>
</section>