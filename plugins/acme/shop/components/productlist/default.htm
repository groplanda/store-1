{% set index = 1 %}
{% set children =  __SELF__.children %}
<div class="breadcrumbs section">
  <div class="breadcrumbs__wrap wrap" itemscope itemtype="https://schema.org/BreadcrumbList">
    {% for breadcrumb in breadcrumbs %}
    {% if not loop.last %}
    <div class="breadcrumbs__item" itemscope itemtype="https://schema.org/BreadcrumbList">
      <a itemprop="item" class="breadcrumbs__link" href="{{ breadcrumb.category ? 'category'|page({slug: breadcrumb.url}) : breadcrumb.url|page }}">
        <span itemprop="name">{{ breadcrumb.title }}</span>
      </a>
      <div class="breadcrumbs__hidden" itemprop="url" href="{{ breadcrumb.category ? 'category'|page({slug: breadcrumb.url}) : breadcrumb.url|page }}"></div>
      <meta itemprop="position" content="{{ index }}" />
      <svg width="10" height="6" class="breadcrumbs__arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.94207 2.85L7.7199 0.824504C7.65816 0.774358 7.59066 0.764709 7.51735 0.79558C7.44412 0.82649 7.40735 0.882393 7.40735 0.96345V2.25976H0.185181C0.131143 2.25976 0.0867528 2.27709 0.0520719 2.31181C0.0174114 2.34651 0 2.3909 0 2.4449V3.55598C0 3.60996 0.0173303 3.65435 0.0520517 3.68901C0.0868136 3.72371 0.131203 3.74104 0.18516 3.74104H7.40739V5.03732C7.40739 5.11459 7.44422 5.17049 7.51741 5.20511C7.59079 5.2361 7.65828 5.22439 7.72002 5.17049L9.94219 3.12173C9.98076 3.08318 10 3.03696 10 2.9829C10 2.93288 9.98064 2.88857 9.94207 2.85Z" fill="black"/>
      </svg>
    </div>
    {% else %}
    <div class="breadcrumbs__item" itemscope itemtype="https://schema.org/BreadcrumbList" >
      <div itemprop="name" class="breadcrumbs__link">{{ category.title }}</div>
      <div class="breadcrumbs__hidden" itemprop="item" itemprop="url" href="{{ 'product'|page({ slug: category.slug }) }}"></div>
      <meta itemprop="position" content="{{ index }}" />
    </div>
    {% endif %}
    {% set index = loop.index + 1 %}
    {% endfor %}
  </div>
</div>

<section id="categorySection" class="category section">
  <div class="category__wrap wrap">

    <div class="category__heading">
      <h1 class="title category__title">{{ category.title }}</h1>
      {% if category.products_count > 0 %}
      <span class="category__suptitle">{{ category.products_count }} {{ countLabel }}</span>
      {% endif %}
    </div>

    {% if children|length > 0 %}
      <div class="shop">
        <div class="shop__container">
          <div class="shop__row">
            {% for subcat in children %}
              <div class="shop__item">
                <a href="{{ 'category'|page({slug:subcat.slug}) }}" class="shop__category" style="--clr: {{subcat.color}}">
                  <span class="shop__category-picture">
                    <picture>
                      <source srcset="{{ subcat.image|media|resize(100, false, { mode: 'crop', quality: '100' })}}" />
                      <img src="{{ subcat.image|media|resize(100, false, { mode: 'crop', quality: '100' })}}" alt="{{ category.title }}" class="shop__category-preview" />
                    </picture>
                  </span>
                  <span class="shop__category-group">
                    <span class="shop__category-name">{{subcat.title}}</span>
                    {% if subcat.products_count > 0 %}
                      <span class="shop__category-info">
                        <span class="shop__category-counter" data-js-action="products-count">{{ subcat.products_count }}</span>
                      </span>
                    {% endif %}
                  </span>
                </a>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% endif %}

    <div class="category__body">
      <div class="shop">
        <div id="partialProducts" class="shop__row">
          {% partial "ProductList::list" %}
        </div>
        <div id="partialPaginate" class="category__pagination">
          {% partial "ProductList::pagination" %}
        </div>
      </div>
    </div>

  </div>
</section>
{% if category.description %}
<section class="content section">
  <div class="wrap content__wrap">
    <h2 class="title content__title">{{ category.meta_title ? category.meta_title : category.title }}</h2>
    <div class="content__entry">
      {{ category.description|raw }}
    </div>
  </div>
</section>
{% endif %}
