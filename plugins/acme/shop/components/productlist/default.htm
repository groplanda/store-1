{% set index = 1 %}
<div class="breadcrumbs section">
  <div class="breadcrumbs__wrap wrap" itemscope itemtype="https://schema.org/BreadcrumbList">
    {% for breadcrumb in breadcrumbs %}
    {% if not loop.last %}
    <div class="breadcrumbs__item" itemscope itemtype="https://schema.org/BreadcrumbList">
      <a itemprop="item" class="breadcrumbs__link" href="{{ breadcrumb.category ? 'category'|page({slug: breadcrumb.url}) : breadcrumb.url|page }}">
        <span itemprop="name">{{ breadcrumb.title }}</span>
      </a>
      <div class="breadcrumbs__hidden" itemprop="url" href="{{ breadcrumb.category ? 'category'|page({slug: breadcrumb.url}) : breadcrumb.url|page }}"></div>
      <meta itemprop="position" content="{{ index }}" />
      <svg width="10" height="6" class="breadcrumbs__arrow" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.94207 2.85L7.7199 0.824504C7.65816 0.774358 7.59066 0.764709 7.51735 0.79558C7.44412 0.82649 7.40735 0.882393 7.40735 0.96345V2.25976H0.185181C0.131143 2.25976 0.0867528 2.27709 0.0520719 2.31181C0.0174114 2.34651 0 2.3909 0 2.4449V3.55598C0 3.60996 0.0173303 3.65435 0.0520517 3.68901C0.0868136 3.72371 0.131203 3.74104 0.18516 3.74104H7.40739V5.03732C7.40739 5.11459 7.44422 5.17049 7.51741 5.20511C7.59079 5.2361 7.65828 5.22439 7.72002 5.17049L9.94219 3.12173C9.98076 3.08318 10 3.03696 10 2.9829C10 2.93288 9.98064 2.88857 9.94207 2.85Z" fill="black"/>
      </svg>
    </div>
    {% else %}
    <div class="breadcrumbs__item" itemscope itemtype="https://schema.org/BreadcrumbList" >
      <div itemprop="name" class="breadcrumbs__link">{{ category.title }}</div>
      <div class="breadcrumbs__hidden" itemprop="item" itemprop="url" href="{{ 'product'|page({ slug: category.slug }) }}"></div>
      <meta itemprop="position" content="{{ index }}" />
    </div>
    {% endif %}
    {% set index = loop.index + 1 %}
    {% endfor %}
  </div>
</div>

<section id="categorySection" class="category section">
  <div class="category__wrap wrap">

    <div class="category__list">
      <div class="title category__list-title">Наши категории</div>
      <div class="category__list-scroll">
        <div class="category__list-row">
          {% for cat in all_categories %}
          <a href="{{ 'category' | page({ slug: cat.slug }) }}" class="category__list-item{{ category.id == cat.id ? ' category__list-item_active' : '' }}">{{ cat.title }}</a>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="category__heading">
      <h1 class="title category__title">{{ category.title }}</h1>
      {% if category.products_count > 0 %}
      <span class="category__suptitle">{{ category.products_count }} {{ countLabel }}</span>
      {% endif %}
    </div>
    <div class="category__body">
      <div class="category__content">
        <div class="category__sort">
          <div class="category__sort-list">
            <div class="category__sort-label" data-js-action="open-sort">
              <span>Сортировка:</span>
              <svg class="category__sort-ico" width="11" height="20" viewBox="0 0 11 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.6195 0.990037C10.5034 0.873629 10.3655 0.781272 10.2136 0.718256C10.0617 0.65524 9.89893 0.622803 9.73451 0.622803C9.5701 0.622803 9.40729 0.65524 9.25543 0.718256C9.10357 0.781272 8.96563 0.873629 8.84951 0.990037L0.539515 9.30004C0.446811 9.39255 0.373263 9.50244 0.323082 9.62341C0.272901 9.74439 0.24707 9.87407 0.24707 10.005C0.24707 10.136 0.272901 10.2657 0.323082 10.3867C0.373263 10.5076 0.446811 10.6175 0.539515 10.71L8.84951 19.02C9.33951 19.51 10.1295 19.51 10.6195 19.02C11.1095 18.53 11.1095 17.74 10.6195 17.25L3.37951 10L10.6295 2.75004C11.1095 2.27004 11.1095 1.47004 10.6195 0.990037Z" fill="currentColor"/>
              </svg>
            </div>
            <div class="category__sort-dropdown" id="partialSort">
              <button type="button" class="category__sort-item category__sort-item_active" data-js-action="sort-products" value="price asc">Сначала дешёвые</button>
              <button type="button" class="category__sort-item" data-js-action="sort-products" value="price desc">Сначала дорогие</button>
              <button type="button" class="category__sort-item" data-js-action="sort-products" value="sale_price desc">По скидкам</button>
              <button type="button" class="category__sort-item" data-js-action="sort-products" value="sort_order asc">По умолчанию</button>
            </div>
          </div>
        </div>
        <div id="partialProducts" class="category__row">
          {% partial "ProductList::list" %}
        </div>
        <div id="partialPaginate" class="category__pagination">
          {% partial "ProductList::pagination" %}
        </div>
      </div>
    </div>

  </div>
</section>
{% if categories %}
<section class="category-additional section">
  <div class="wrap category-additional__wrap">
    <h2 class="title title_sm category-additional__title">Другие типы {{ category.title }}</h2>
    <div class="category-additional__row">
      {% for cat in categories %}
      <div class="category-additional__item">
        <a href="{{ 'category' | page({ slug: cat.slug }) }}" class="category-additional__image {{ cat.image ? 'category-additional__image_overlay' : '' }}">
          {% if cat.image %}
          <img src="{{ cat.image|media|resize(166, 100, { mode: 'crop', quality: '80' }) }}" alt="{{ cat.title }}" class="category-additional__pic" />
          {% endif %}
        </a>
        <a href="{{ 'category' | page({ slug: cat.slug }) }}" class="category-additional__link">{{ cat.title }}</a>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}
<section class="content section">
  <div class="wrap content__wrap">
    <h2 class="title content__title">{{ category.meta_title ? category.meta_title : category.title }}</h2>
    <div class="content__entry">
      {{ category.description|raw }}
    </div>
  </div>
</section>