<template>
<div class="checkout__cart-item">
  <div class="checkout__cart-item-top">
    <div class="checkout__cart-item-image">
      <a :href="'/product/' + product.id">
        <img :src="product.image ? '/storage/app/media' + product.image : noImage" :alt="product.title" class="checkout__cart-item-thumb" />
      </a>
    </div>
    <div class="checkout__cart-item-content">
      <a :href="'/product/' + product.id" class="checkout__cart-item-title">{{ product.title }}</a>
      <div class="checkout__cart-item-prices">
        <template v-if="product.sale_price > 0">
          <div class="checkout__cart-item-price">{{ productPrice(product.sale_price) }}</div>
          <div class="checkout__cart-item-oldprice">{{ productPrice(product.price) }}</div>
        </template>
        <div class="checkout__cart-item-price" v-else>{{ productPrice(product.price) }}</div>
      </div>
      <!-- desktop start -->
      <div class="checkout__cart-item-trigger checkout__cart-item-trigger_desktop">
        <button type="button" class="checkout__cart-item-remove" @click="deleteProduct">
          <svg class="checkout__cart-item-trash" viewBox="0 0 20 23" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path opacity="0.3" d="M18.6505 4.08984H13.963V2.91797C13.963 2.39997 13.7572 1.90318 13.391 1.5369C13.0247 1.17062 12.5279 0.964844 12.0099 0.964844H8.10364C7.58564 0.964844 7.08885 1.17062 6.72257 1.5369C6.35629 1.90318 6.15051 2.39997 6.15051 2.91797V4.08984H1.46301C1.25581 4.08984 1.0571 4.17215 0.910586 4.31867C0.764073 4.46518 0.681763 4.66389 0.681763 4.87109C0.681763 5.07829 0.764073 5.27701 0.910586 5.42352C1.0571 5.57003 1.25581 5.65234 1.46301 5.65234H2.29309L3.22083 20.541C3.29016 21.8521 4.29504 22.8398 5.56458 22.8398H14.549C15.8248 22.8398 16.8097 21.874 16.8927 20.5449L17.8204 5.65234H18.6505C18.8577 5.65234 19.0564 5.57003 19.2029 5.42352C19.3495 5.27701 19.4318 5.07829 19.4318 4.87109C19.4318 4.66389 19.3495 4.46518 19.2029 4.31867C19.0564 4.17215 18.8577 4.08984 18.6505 4.08984ZM6.9596 19.7148H6.93176C6.7293 19.715 6.53469 19.6365 6.38895 19.4959C6.24321 19.3554 6.15773 19.1638 6.15051 18.9614L5.75989 8.02393C5.75251 7.81673 5.82774 7.61508 5.96903 7.46335C6.11032 7.31161 6.3061 7.22223 6.51331 7.21484C6.72051 7.20746 6.92215 7.28269 7.07388 7.42399C7.22562 7.56528 7.31501 7.76106 7.32239 7.96826L7.71301 18.9058C7.71673 19.0084 7.70019 19.1107 7.66433 19.2069C7.62847 19.3031 7.57399 19.3913 7.50402 19.4665C7.43405 19.5416 7.34995 19.6022 7.25653 19.6449C7.16311 19.6875 7.06221 19.7113 6.9596 19.7148ZM10.838 18.9336C10.838 19.1408 10.7557 19.3395 10.6092 19.486C10.4627 19.6325 10.264 19.7148 10.0568 19.7148C9.84956 19.7148 9.65085 19.6325 9.50434 19.486C9.35782 19.3395 9.27551 19.1408 9.27551 18.9336V7.99609C9.27551 7.78889 9.35782 7.59018 9.50434 7.44367C9.65085 7.29715 9.84956 7.21484 10.0568 7.21484C10.264 7.21484 10.4627 7.29715 10.6092 7.44367C10.7557 7.59018 10.838 7.78889 10.838 7.99609V18.9336ZM12.4005 4.08984H7.71301V2.91797C7.71242 2.86651 7.72213 2.81545 7.74155 2.76779C7.76097 2.72013 7.78972 2.67683 7.82611 2.64044C7.8625 2.60405 7.9058 2.5753 7.95346 2.55588C8.00112 2.53646 8.05218 2.52675 8.10364 2.52734H12.0099C12.0613 2.52675 12.1124 2.53646 12.1601 2.55588C12.2077 2.5753 12.251 2.60405 12.2874 2.64044C12.3238 2.67683 12.3526 2.72013 12.372 2.76779C12.3914 2.81545 12.4011 2.86651 12.4005 2.91797V4.08984ZM13.963 18.9614C13.9558 19.1638 13.8703 19.3554 13.7246 19.4959C13.5788 19.6365 13.3842 19.715 13.1818 19.7148H13.1534C13.0509 19.7112 12.95 19.6874 12.8567 19.6447C12.7633 19.6021 12.6793 19.5415 12.6093 19.4663C12.5394 19.3912 12.485 19.303 12.4491 19.2068C12.4133 19.1106 12.3968 19.0083 12.4005 18.9058L12.7911 7.96826C12.7948 7.86567 12.8186 7.7648 12.8613 7.67141C12.9039 7.57802 12.9645 7.49395 13.0396 7.42399C13.1148 7.35402 13.2029 7.29955 13.2991 7.26366C13.3953 7.22778 13.4976 7.21119 13.6002 7.21484C13.7028 7.2185 13.8037 7.24233 13.8971 7.28496C13.9905 7.3276 14.0745 7.38822 14.1445 7.46335C14.2145 7.53848 14.2689 7.62665 14.3048 7.72284C14.3407 7.81902 14.3573 7.92133 14.3536 8.02393L13.963 18.9614Z" fill="black"/>
          </svg>
        </button>
        <CartAmount :amount="count" @changeAmount="changeAmount" />
      </div>
      <!-- desktop end -->
    </div>
  </div>
  <!-- mobile start -->
  <div class="checkout__cart-item-trigger checkout__cart-item-trigger_mobile">
    <button type="button" class="checkout__cart-item-remove" @click="deleteProduct">
      <svg class="checkout__cart-item-trash" viewBox="0 0 20 23" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path opacity="0.3" d="M18.6505 4.08984H13.963V2.91797C13.963 2.39997 13.7572 1.90318 13.391 1.5369C13.0247 1.17062 12.5279 0.964844 12.0099 0.964844H8.10364C7.58564 0.964844 7.08885 1.17062 6.72257 1.5369C6.35629 1.90318 6.15051 2.39997 6.15051 2.91797V4.08984H1.46301C1.25581 4.08984 1.0571 4.17215 0.910586 4.31867C0.764073 4.46518 0.681763 4.66389 0.681763 4.87109C0.681763 5.07829 0.764073 5.27701 0.910586 5.42352C1.0571 5.57003 1.25581 5.65234 1.46301 5.65234H2.29309L3.22083 20.541C3.29016 21.8521 4.29504 22.8398 5.56458 22.8398H14.549C15.8248 22.8398 16.8097 21.874 16.8927 20.5449L17.8204 5.65234H18.6505C18.8577 5.65234 19.0564 5.57003 19.2029 5.42352C19.3495 5.27701 19.4318 5.07829 19.4318 4.87109C19.4318 4.66389 19.3495 4.46518 19.2029 4.31867C19.0564 4.17215 18.8577 4.08984 18.6505 4.08984ZM6.9596 19.7148H6.93176C6.7293 19.715 6.53469 19.6365 6.38895 19.4959C6.24321 19.3554 6.15773 19.1638 6.15051 18.9614L5.75989 8.02393C5.75251 7.81673 5.82774 7.61508 5.96903 7.46335C6.11032 7.31161 6.3061 7.22223 6.51331 7.21484C6.72051 7.20746 6.92215 7.28269 7.07388 7.42399C7.22562 7.56528 7.31501 7.76106 7.32239 7.96826L7.71301 18.9058C7.71673 19.0084 7.70019 19.1107 7.66433 19.2069C7.62847 19.3031 7.57399 19.3913 7.50402 19.4665C7.43405 19.5416 7.34995 19.6022 7.25653 19.6449C7.16311 19.6875 7.06221 19.7113 6.9596 19.7148ZM10.838 18.9336C10.838 19.1408 10.7557 19.3395 10.6092 19.486C10.4627 19.6325 10.264 19.7148 10.0568 19.7148C9.84956 19.7148 9.65085 19.6325 9.50434 19.486C9.35782 19.3395 9.27551 19.1408 9.27551 18.9336V7.99609C9.27551 7.78889 9.35782 7.59018 9.50434 7.44367C9.65085 7.29715 9.84956 7.21484 10.0568 7.21484C10.264 7.21484 10.4627 7.29715 10.6092 7.44367C10.7557 7.59018 10.838 7.78889 10.838 7.99609V18.9336ZM12.4005 4.08984H7.71301V2.91797C7.71242 2.86651 7.72213 2.81545 7.74155 2.76779C7.76097 2.72013 7.78972 2.67683 7.82611 2.64044C7.8625 2.60405 7.9058 2.5753 7.95346 2.55588C8.00112 2.53646 8.05218 2.52675 8.10364 2.52734H12.0099C12.0613 2.52675 12.1124 2.53646 12.1601 2.55588C12.2077 2.5753 12.251 2.60405 12.2874 2.64044C12.3238 2.67683 12.3526 2.72013 12.372 2.76779C12.3914 2.81545 12.4011 2.86651 12.4005 2.91797V4.08984ZM13.963 18.9614C13.9558 19.1638 13.8703 19.3554 13.7246 19.4959C13.5788 19.6365 13.3842 19.715 13.1818 19.7148H13.1534C13.0509 19.7112 12.95 19.6874 12.8567 19.6447C12.7633 19.6021 12.6793 19.5415 12.6093 19.4663C12.5394 19.3912 12.485 19.303 12.4491 19.2068C12.4133 19.1106 12.3968 19.0083 12.4005 18.9058L12.7911 7.96826C12.7948 7.86567 12.8186 7.7648 12.8613 7.67141C12.9039 7.57802 12.9645 7.49395 13.0396 7.42399C13.1148 7.35402 13.2029 7.29955 13.2991 7.26366C13.3953 7.22778 13.4976 7.21119 13.6002 7.21484C13.7028 7.2185 13.8037 7.24233 13.8971 7.28496C13.9905 7.3276 14.0745 7.38822 14.1445 7.46335C14.2145 7.53848 14.2689 7.62665 14.3048 7.72284C14.3407 7.81902 14.3573 7.92133 14.3536 8.02393L13.963 18.9614Z" fill="black"/>
      </svg>
    </button>
    <CartAmount :amount="count" @changeAmount="changeAmount" />
  </div>
  <!-- mobile end -->
</div>
</template>
<script>
import CartAmount from "./CartAmount";

export default {
  name: "CartItem",
  components: {
    CartAmount
  },
  props: {
    product: {
      type: Object,
      required: true
    }
  },
  data() {
    return {
      count: this.product.amount,
      noImage: "/themes/store/assets/images/no-image.jpg"
    }
  },
  methods: {
    productPrice(price) {
      return price.toLocaleString('ru') + ' â‚½';
    },
    changeAmount(val) {
      this.count = val;
      const optionId = this.product.optionId ? this.product.optionId : null;
      this.$emit("changeAmount", { id: this.product.id, amount: this.count, optionId: optionId });
    },
    deleteProduct() {
      const optionId = this.product.optionId ? this.product.optionId : null;
      this.$emit("deleteProduct", { id: this.product.id, optionId: optionId });
    }
  }
}
</script>